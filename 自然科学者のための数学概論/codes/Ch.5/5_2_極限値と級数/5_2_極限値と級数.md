# 複素数級数の可視化：等比級数の収束

このプロジェクトは、複素解析における「級数の収束」という概念を、p5.jsを用いて視覚的に理解するためのシミュレーションです。
教科書（5.2 極限値と級数）にある $\lim_{n \to \infty} S_n = S$ の挙動を、具体的な**複素等比級数**を例にとって実装しています。

## 1. 数学的な背景

### 教科書の定義
複素数列 $\{a_n\}$ の和（級数）を以下のように定義します。

$$\sum_{n=1}^{\infty} a_n = a_1 + a_2 + a_3 + \dots$$

部分和 $S_n = a_1 + \dots + a_n$ がある一定の複素数 $S$ に近づくとき、この級数は**収束する**と言います。

### 今回の実装モデル：等比級数
このプログラムでは、最も基本的かつ挙動が美しい「等比級数」を扱います。
初項を $1$、公比を複素数 $z$ とします。

$$S = \sum_{n=0}^{\infty} z^n = 1 + z + z^2 + z^3 + \dots$$

この級数は、複素数 $z$ の絶対値が $1$ 未満（$|z| < 1$）のとき収束し、その極限値は以下の式で求められます。

$$\lim_{n \to \infty} S_n = \frac{1}{1-z}$$

## 2. 実装のアルゴリズム

プログラムは、マウスの位置を入力として複素数 $z$ を決定し、級数の部分和がどのように変化するかをリアルタイムで描画します。

### A. 準備 (Setup)
* **座標系**: 画面の中央を原点 $(0, 0)$ とします。
* **スケール**: 複素平面上の $1$ を、画面上の特定のピクセル数（例: 200px）に対応させます。

### B. ループ処理 (Draw Loop)

1.  **公比 $z$ の決定**
    * マウス座標を複素平面上の座標に変換し、これを公比 $z$ とします。
    * `Complex` クラスのインスタンスとして生成します。

2.  **シミュレーション (部分和の描画)**
    * 初期値として、現在の項 `term` を $1$、部分和 `sum` を $1$ に設定します。
    * ループ（約100回）を回し、以下の計算を行います。
        1.  **次の項の計算**: `term = term * z` （複素数の乗算）
        2.  **部分和の更新**: `sum = sum + term` （複素数の加算）
        3.  **描画**: 前回の部分和の位置から、今回の部分和の位置へ線を引きます。これをつなげると、各項 $z^n$ をベクトルとして継ぎ足していく様子（螺旋状の軌跡）が描かれます。

3.  **理論値の計算と検証**
    * $|z| < 1$ の場合、理論上の収束点（極限値）を計算します。
    * 数式 $S = \frac{1}{1-z}$ を `Complex` クラスのメソッドで実装します。
        ```javascript
        let denominator = Complex.sub(1, z);    // 分母 (1 - z)
        let limit = Complex.div(1, denominator); // 極限 1 / (1 - z)
        ```
    * 計算された位置に「赤い点」を描画します。

### C. 視覚的な確認ポイント
* **収束**: 白い線の先端（シミュレーション結果）が、赤い点（数式の理論値）に吸い込まれるように一致すれば、理論通りに実装できています。
* **回転**: $z$ が虚数成分を持つとき、足し算の軌跡は渦巻きを描きます（複素数の積による回転作用）。
* **発散**: マウスを画面端（$|z| \ge 1$）に持っていくと、級数は無限遠へ発散し、赤い点は消えます。

## 3. コードの構造 (クラス設計)

計算ロジックを直感的にするために、ユーザー定義の `Complex` クラスを使用しています。これにより、数式とコードの対応関係が明確になっています。

| 数式 | コード表現 (Complex Class) |
| :--- | :--- |
| $z_1 + z_2$ | `z1.add(z2)` |
| $z_1 \times z_2$ | `z1.mult(z2)` |
| $\frac{z_1}{z_2}$ | `z1.div(z2)` |
| $|z|$ | `z.mag()` |

---
*Created by 作って学ぶ数学題材サポート*